(this.webpackJsonpchatapp=this.webpackJsonpchatapp||[]).push([[0],{120:function(e,t){},123:function(e,t,s){},124:function(e,t,s){},125:function(e,t,s){},126:function(e,t,s){},127:function(e,t,s){},128:function(e,t,s){"use strict";s.r(t);var a=s(0),r=s.n(a),n=s(14),i=s.n(n),o=(s(71),s(136)),c=s(139),l=s(133),h=s(135),d=s(132),g=s(134),p=s(137),m=s(131),u=s(138),j=s(25),v=s.n(j);const b=()=>{try{return localStorage.getItem("userid")}catch(e){return console.error("Error getting user ID from storage:",e),null}},y=()=>{try{return localStorage.getItem("username")}catch(e){return console.error("Error getting username from storage:",e),null}},U=e=>{try{return localStorage.getItem(e)}catch(t){return console.error("Error getting ".concat(e," from storage:"),t),null}},S=(e,t)=>{try{localStorage.setItem(e,t)}catch(s){console.error("Error setting ".concat(e," in storage:"),s)}},x=v.a.create({baseURL:"http://localhost:4000",headers:{"Content-Type":"application/json"}});x.interceptors.request.use((e=>{const t=b(),s=y();return t&&(e.headers["X-User-ID"]=t),s&&(e.headers["X-Username"]=s),e}),(e=>(console.error("[Axios Request Error]",e),Promise.reject(e)))),x.interceptors.response.use((e=>e),(e=>(console.error("[Axios Response Error]",(null===e||void 0===e?void 0:e.response)||e),e.response&&401===e.response.status&&console.warn("Unauthorized - Redirect to login"),Promise.reject(e))));var O=x;var w=new class{getUserId(){return b()}getUsername(){return y()}setLS(e,t){return S(e,t)}getLS(e){return U(e)}removeLS(){return(()=>{try{localStorage.removeItem("userid"),localStorage.removeItem("username"),localStorage.removeItem("token")}catch(e){console.error("Error clearing localStorage:",e)}})()}async login(e){try{const t=await O.post("/login",e),{token:s}=t.data;return s&&S("token",s),t.data}catch(t){throw t}}async checkUsernameAvailability(e){try{const t=U("token");return(await O.post("/usernameAvailable",{username:e},{headers:{Authorization:t}})).data}catch(t){throw t}}async register(e){try{const t=U("token");return(await O.post("/register",e,{headers:{Authorization:t}})).data}catch(t){throw t}}async userSessionCheck(e){try{const t=U("token");return(await O.post("/userSessionCheck",{userId:e},{headers:{Authorization:t}})).data}catch(t){throw t}}async getMessages(e,t){try{const s=U("token");return(await O.post("/getMessages",{userId:e,toUserId:t},{headers:{Authorization:s}})).data}catch(s){throw s}}async uploadFile(e){try{return(await O.post("/upload",e,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(t){throw t}}},I=(s(89),s(1));class f extends a.Component{constructor(e){super(e),this.handleLogin=async e=>{e.preventDefault(),this.props.loadingState(!0);try{const e=await w.login(this.state);this.props.loadingState(!1),e.error?this.setState({loginError:!0}):(w.setLS("userid",e.userId),this.props.history.push("/home"))}catch(t){this.props.loadingState(!1),this.setState({loginError:!0})}},this.handleInputChange=e=>{this.setState({[e.target.name]:e.target.value,loginError:!1})},this.state={username:"",password:"",loginError:!1}}render(){return Object(I.jsxs)(g.a,{className:"auth-form",children:[this.state.loginError&&Object(I.jsx)(p.a,{variant:"danger",children:"Invalid login details"}),Object(I.jsx)(g.a.Group,{controlId:"loginUsername",children:Object(I.jsx)(g.a.Control,{type:"text",name:"username",placeholder:"Enter username",onChange:this.handleInputChange})}),Object(I.jsx)(g.a.Group,{controlId:"loginPassword",children:Object(I.jsx)(g.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:this.handleInputChange})}),Object(I.jsx)(m.a,{variant:"primary",type:"submit",onClick:this.handleLogin,children:"Login"})]})}}var C=Object(u.a)(f),k=s(64);s(97);class L extends a.Component{constructor(e){super(e),this.handleRegistration=async e=>{e.preventDefault(),this.props.loadingState(!0);try{const e=await w.register(this.state);this.props.loadingState(!1),e.error?this.setState({registrationError:!0}):(w.setLS("userid",e.userId),this.props.history.push("/home"))}catch(t){this.props.loadingState(!1),this.setState({registrationError:!0})}},this.checkUsernameAvailability=async e=>{if(""!==e.target.value&&void 0!==e.target.value){this.setState({username:e.target.value}),this.props.loadingState(!0);try{const e=await w.checkUsernameAvailability(this.state.username);this.props.loadingState(!1),e.error?this.setState({usernameAvailable:!1}):this.setState({usernameAvailable:!0})}catch(t){this.props.loadingState(!1),this.setState({usernameAvailable:!1})}}else""===e.target.value&&this.setState({usernameAvailable:!0})},this.handleInputChange=e=>{this.setState({[e.target.name]:e.target.value})},this.state={username:"",password:"",usernameAvailable:!0,registrationError:!1}}render(){return Object(I.jsxs)(g.a,{className:"auth-form",children:[Object(I.jsxs)(g.a.Group,{controlId:"formUsername",children:[Object(I.jsx)(k.DebounceInput,{className:"form-control",placeholder:"Enter username",minLength:2,debounceTimeout:300,onChange:this.checkUsernameAvailability}),Object(I.jsxs)(p.a,{className:"username-availability-warning ".concat(this.state.usernameAvailable?"visibility-hidden":""),variant:"danger",children:[Object(I.jsx)("strong",{children:this.state.username})," is already taken, try another username."]})]}),Object(I.jsx)(g.a.Group,{controlId:"formPassword",children:Object(I.jsx)(g.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:this.handleInputChange})}),this.state.registrationError&&Object(I.jsx)(p.a,{variant:"danger",children:"Unable to register. Please try again later."}),Object(I.jsx)(m.a,{variant:"primary",type:"submit",onClick:this.handleRegistration,children:"Registration"})]})}}var N=Object(u.a)(L);s(98);class M extends a.Component{constructor(){super(...arguments),this.state={loadingState:!1},this.setRenderLoadingState=e=>{this.setState({loadingState:e})}}render(){return Object(I.jsxs)("div",{className:"container",children:[Object(I.jsx)("div",{className:"overlay auth-loading ".concat(this.state.loadingState?"":"visibility-hidden"),children:Object(I.jsx)("h1",{children:"Loading"})}),Object(I.jsx)("div",{className:"authentication-screen",children:Object(I.jsxs)(h.a,{variant:"pills",defaultActiveKey:"login",children:[Object(I.jsx)(d.a,{eventKey:"login",title:"Login",children:Object(I.jsx)(C,{loadingState:this.setRenderLoadingState})}),Object(I.jsx)(d.a,{eventKey:"registration",title:"Registration",children:Object(I.jsx)(N,{loadingState:this.setRenderLoadingState})})]})})]})}}var T=M,E=s(65),A=s(66);const R="chat-list-response",D="add-message-response",F="logout-response";var P=new class{constructor(){this.socket=null,this.eventEmitter=new A.EventEmitter}establishSocketConnection(e){try{this.socket=Object(E.io)("http://localhost:4000",{query:"userId=".concat(e)})}catch(t){alert("Something went wrong; Can't connect to socket server")}}getChatList(e){this.socket.emit("chat-list",{userId:e}),this.socket.on(R,(e=>{this.eventEmitter.emit(R,e)}))}typing(e){this.socket.emit("typing",e)}stopTyping(e){this.socket.emit("stopTyping",e)}sendMessage(e){this.socket.emit("add-message",e)}sendMessageRead(e){this.socket.emit("message-read",e)}receiveMessage(){this.socket.on(D,(e=>{this.eventEmitter.emit(D,e)}))}logout(e){this.socket.emit("logout",e),this.socket.on(F,(e=>{this.eventEmitter.emit(F,e)}))}};s(123);class _ extends a.Component{constructor(e){super(e),this.createChatListUsers=e=>{if(e.error)console.error("Unable to load Chat list, Redirecting to Login.");else{let t=this.state.chatListUsers;if(e.singleUser)t.length>0&&(t=t.filter((t=>t.id!==e.chatList[0].id))),t=[...t,...e.chatList];else if(e.userDisconnected){const s=t.findIndex((t=>t.id===e.userid));s>=0&&(t[s].online="N")}else t=e.chatList;this.setState({chatListUsers:t})}this.setState({loading:!1})},this.selectedUser=e=>{this.setState({selectedUserId:e.id}),this.props.updateSelectedUser(e)},this.state={loading:!0,selectedUserId:null,chatListUsers:[]}}componentDidMount(){const e=this.props.userId;P.getChatList(e),P.eventEmitter.on("chat-list-response",this.createChatListUsers)}componentWillUnmount(){P.eventEmitter.removeListener("chat-list-response",this.createChatListUsers)}render(){return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("ul",{className:"user-list ".concat(0===this.state.chatListUsers.length?"visibility-hidden":""),children:this.state.chatListUsers.map((e=>Object(I.jsxs)("li",{className:this.state.selectedUserId===e.id?"active":"",onClick:()=>this.selectedUser(e),children:[e.username,Object(I.jsx)("span",{className:"Y"===e.online?"online":"offline"})]},e.id)))}),Object(I.jsx)("div",{className:"alert \n          ".concat(this.state.loading?"alert-info":""," \n          ").concat(this.state.chatListUsers.length>0?"visibility-hidden":""),children:this.state.loading||0===this.state.chatListUsers.length?"Loading your chat list.":"No User Available to chat."})]})}}var z=_,B=s(21);s(124);class V extends a.Component{constructor(e){super(e),this.receiveSocketMessages=e=>{const{selectedUser:t}=this.state;t&&t.id===e.fromUserId&&(this.setState({conversations:[...this.state.conversations,e]}),this.scrollMessageContainer(),P.sendMessageRead({fromUserId:this.props.userId,toUserId:t.id,messageId:e._id}))},this.handleTypingIndicator=e=>{const{newSelectedUser:t}=this.props;t&&e.fromUserId===t.id&&this.setState({isTyping:!0,typingUser:e.username})},this.handleStopTypingIndicator=e=>{const{newSelectedUser:t}=this.props;t&&e.fromUserId===t.id&&this.setState({isTyping:!1,typingUser:""})},this.handleMessageRead=e=>{let{messageId:t}=e;const s=this.state.conversations.map((e=>e._id===t?Object(B.a)(Object(B.a)({},e),{},{read:!0}):e));this.setState({conversations:s})},this.getMessages=async()=>{try{const{userId:e,newSelectedUser:t}=this.props,s=await w.getMessages(e,t.id);s.error?console.error("Unable to fetch messages"):(this.setState({conversations:s.messages}),this.scrollMessageContainer()),this.setState({messageLoading:!1})}catch(e){console.error("Message fetch error:",e),this.setState({messageLoading:!1})}},this.sendMessage=e=>{if("Enter"===e.key){e.preventDefault();const t=e.target.value.trim(),{userId:s,newSelectedUser:a}=this.props;if(!t||!s||!a)return;this.sendAndUpdateMessages({fromUserId:s,message:t,toUserId:a.id,timestamp:new Date}),e.target.value="",P.stopTyping({fromUserId:s,toUserId:a.id})}},this.handleTyping=e=>{const{userId:t,newSelectedUser:s}=this.props;s&&(P.typing({fromUserId:t,toUserId:s.id,username:this.props.username||"User"}),clearTimeout(this.typingTimeout),this.typingTimeout=setTimeout((()=>{P.stopTyping({fromUserId:t,toUserId:s.id})}),1e3))},this.handleFileChange=e=>{const t=e.target.files[0];if(t){const e=URL.createObjectURL(t);this.setState({previewUrl:e,selectedFile:t})}},this.handleFileUpload=async()=>{const{userId:e,newSelectedUser:t}=this.props,{selectedFile:s}=this.state;if(s&&e&&t)try{const a=await(async e=>{const t=new FormData;t.append("image",e);try{return(await v.a.post("".concat("http://localhost:4000","/upload"),t,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(s){throw console.error("Upload failed:",s),s}})(s);if(a&&a.imageUrl){const s={fromUserId:e,toUserId:t.id,message:a.imageUrl,isFile:!0,timestamp:new Date};this.sendAndUpdateMessages(s),this.setState({previewUrl:null,selectedFile:null})}}catch(a){console.error("Upload failed:",a)}},this.state={messageLoading:!0,conversations:[],selectedUser:null,isTyping:!1,typingUser:"",previewUrl:null,selectedFile:null},this.messageContainer=r.a.createRef(),this.typingTimeout=null}componentDidMount(){P.receiveMessage(),P.socket.on("typing",this.handleTypingIndicator),P.socket.on("stopTyping",this.handleStopTypingIndicator),P.socket.on("message-read",this.handleMessageRead),P.eventEmitter.on("add-message-response",this.receiveSocketMessages)}componentWillUnmount(){P.eventEmitter.removeListener("add-message-response",this.receiveSocketMessages),P.socket.off("typing",this.handleTypingIndicator),P.socket.off("stopTyping",this.handleStopTypingIndicator),P.socket.off("message-read",this.handleMessageRead)}componentDidUpdate(e){null!==e.newSelectedUser&&this.props.newSelectedUser.id===e.newSelectedUser.id||this.getMessages()}static getDerivedStateFromProps(e,t){return null===t.selectedUser||t.selectedUser.id!==e.newSelectedUser.id?{selectedUser:e.newSelectedUser}:null}sendAndUpdateMessages(e){try{P.sendMessage(e),this.setState({conversations:[...this.state.conversations,Object(B.a)(Object(B.a)({},e),{},{read:!1})]}),this.scrollMessageContainer()}catch(t){console.error("Can't send your message",t)}}scrollMessageContainer(){if(null!==this.messageContainer.current)try{setTimeout((()=>{this.messageContainer.current.scrollTop=this.messageContainer.current.scrollHeight}),100)}catch(e){console.warn(e)}}alignMessages(e){return this.props.userId!==e}formatTimestamp(e){if(!e)return"";return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}getMessageUI(){return Object(I.jsx)("ul",{ref:this.messageContainer,className:"message-thread",children:this.state.conversations.map(((e,t)=>Object(I.jsxs)("li",{className:"".concat(this.alignMessages(e.toUserId)?"align-right":""),children:[Object(I.jsx)("div",{children:e.isFile?e.message.match(/\.(jpg|jpeg|png|gif)$/i)?Object(I.jsx)("img",{src:e.message,alt:"sent",className:"chat-image"}):Object(I.jsx)("a",{href:e.message,target:"_blank",rel:"noopener noreferrer",children:"Download File"}):e.message}),Object(I.jsxs)("div",{className:"message-meta",children:[Object(I.jsx)("span",{className:"timestamp",children:this.formatTimestamp(e.timestamp)}),this.alignMessages(e.toUserId)&&Object(I.jsx)("span",{className:"read-status",children:e.read?"\u2714":"\ud83d\udd53"})]})]},t)))})}getInitiateConversationUI(){if(null!==this.props.newSelectedUser)return Object(I.jsx)("div",{className:"message-thread start-chatting-banner",children:Object(I.jsxs)("p",{className:"heading",children:["You haven't chatted with ",this.props.newSelectedUser.username," in a while,",Object(I.jsx)("span",{className:"sub-heading",children:" Say Hi."})]})})}render(){const{messageLoading:e,selectedUser:t,isTyping:s,typingUser:a,previewUrl:r}=this.state;return Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("div",{className:"message-overlay ".concat(e?"":"visibility-hidden"),children:Object(I.jsx)("h3",{children:t&&t.username?"Loading Messages":" Select a User to chat."})}),Object(I.jsxs)("div",{className:"message-wrapper ".concat(e?"visibility-hidden":""),children:[Object(I.jsxs)("div",{className:"message-container",children:[Object(I.jsxs)("div",{className:"opposite-user",children:["Chatting with"," ",this.props.newSelectedUser?this.props.newSelectedUser.username:"----"]}),this.state.conversations.length>0?this.getMessageUI():this.getInitiateConversationUI(),s&&Object(I.jsxs)("div",{className:"typing-indicator",children:[a," is typing..."]})]}),Object(I.jsx)("div",{className:"message-typer",children:Object(I.jsxs)("form",{children:[Object(I.jsx)("textarea",{className:"message form-control",placeholder:"Type and hit Enter",onKeyPress:this.sendMessage,onChange:this.handleTyping}),Object(I.jsx)("div",{className:"file-upload",children:Object(I.jsx)("input",{type:"file",onChange:this.handleFileChange,accept:"image/*,application/pdf"})}),r&&Object(I.jsxs)("div",{className:"image-preview",children:[Object(I.jsx)("img",{src:r,alt:"preview",width:"100"}),Object(I.jsx)("button",{type:"button",onClick:this.handleFileUpload,children:"Send Image"})]})]})})]})]})}}var G=V;s(125);class K extends a.Component{constructor(){super(...arguments),this.userId=null,this.state={isOverlayVisible:!0,username:"______",selectedUser:null},this.logout=async()=>{try{await w.removeLS(),P.logout({userId:this.userId}),P.eventEmitter.on("logout-response",(e=>{this.props.history.push("/")}))}catch(e){throw console.log(e),alert(" This App is Broken, we are working on it. try after some time."),e}},this.setRenderLoadingState=e=>{this.setState({isOverlayVisible:e})},this.updateSelectedUser=e=>{this.setState({selectedUser:e})},this.getChatBoxComponent=()=>this.state.isOverlayVisible?null:Object(I.jsx)(G,{userId:this.userId,newSelectedUser:this.state.selectedUser})}async componentDidMount(){try{this.setRenderLoadingState(!0),this.userId=await w.getUserId();const e=await w.userSessionCheck(this.userId);e.error?this.props.history.push("/"):(this.setState({username:e.username}),w.setLS("username",e.username),P.establishSocketConnection(this.userId)),this.setRenderLoadingState(!1)}catch(e){this.setRenderLoadingState(!1),this.props.history.push("/")}}getChatListComponent(){return this.state.isOverlayVisible?null:Object(I.jsx)(z,{userId:this.userId,updateSelectedUser:this.updateSelectedUser})}render(){return Object(I.jsxs)("div",{className:"App",children:[Object(I.jsx)("div",{className:"".concat(this.state.isOverlayVisible?"overlay":"visibility-hidden"," "),children:Object(I.jsx)("h1",{children:"Loading"})}),Object(I.jsxs)("header",{className:"app-header",children:[Object(I.jsx)("nav",{className:"navbar navbar-expand-md",children:Object(I.jsxs)("h4",{children:["Hello ",this.state.username," "]})}),Object(I.jsx)("ul",{className:"nav justify-content-end",children:Object(I.jsx)("li",{className:"nav-item",children:Object(I.jsx)("a",{className:"nav-link",href:"#",onClick:this.logout,children:"Logout"})})})]}),Object(I.jsx)("main",{role:"main",className:"container content",children:Object(I.jsxs)("div",{className:"row chat-content",children:[Object(I.jsx)("div",{className:"col-3 chat-list-container",children:this.getChatListComponent()}),Object(I.jsx)("div",{className:"col-8 message-container",children:this.getChatBoxComponent()})]})})]})}}var W=Object(u.a)(K);s(126);class q extends a.Component{render(){return Object(I.jsx)("div",{className:"App",children:"NotFound Component"})}}var H=q;s(127);class J extends a.Component{render(){return Object(I.jsx)(o.a,{children:Object(I.jsxs)(c.a,{children:[Object(I.jsx)(l.a,{path:"/",exact:!0,component:T}),Object(I.jsx)(l.a,{path:"/home/",component:W}),Object(I.jsx)(l.a,{component:H})]})})}}var X=J;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(Object(I.jsx)(X,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((e=>{e.unregister()}))},71:function(e,t,s){},89:function(e,t,s){},97:function(e,t,s){},98:function(e,t,s){}},[[128,1,2]]]);
//# sourceMappingURL=main.6e1aab25.chunk.js.map